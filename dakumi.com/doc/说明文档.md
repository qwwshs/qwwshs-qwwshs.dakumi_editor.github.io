# 说明文档

## 使用的注意事项

::: warning

- 更新到v0.5.0请按照更新指南进行更新
- 更新到v0.3.0之后需要手动更改谱面后缀成```d3```

:::

::: tip

- ```offset```的单位为```ms```

- ```bpm(每分钟节拍数)```的```beat（节拍）```从左到右 分别是 节拍的整数部分 分数的分子部分 分母部分

- ```x``` ```w```的范围为```0-100```(默认偏好下)

- 谱面会保存到```users```文件夹内(v0.5.0以下版本在```love2d```的文件夹内 点击按钮```目录```打开)

:::

---

## 使用教程

## 选择界面

### 导入

+ 导入文件只需要将文件拖入窗口即可 创建谱面时将音频导入即可

::: warning

如果导入文件导致 __dakumi报错__ 请将该文件删除 若导入的为音频（用于创建谱面） 请将在```user/chart/```里存放该音频的文件夹一起删除

:::


|文件类型|方式|注意事项|
|----|----|----|
|歌曲|拖入dakumi_editor的窗口中|后缀应为```wav```;```mp3```;```ogg```且后缀必须正确|
|谱面|选择到该谱面的歌曲然后拖入窗口|可以导入```.d3``` ```.json```|
|曲绘|选择到该谱面的歌曲然后拖入窗口|后缀应为```jpg```;```jpeg```;```png```且后缀必须正确 不然 __dakumi_editor会报错__|

## 编辑界面

编辑界面中细分了几个区域 分别是```工具栏``` ```侧边栏``` ```play``` ```edit```

### 工具栏

工具栏位于编辑界面上方 包含了一些常用的功能

|按钮|功能|对应的快捷键|
|----|----|----|
|play/pause|播放当前谱面/停止播放|空格键|
|save|保存|ctrl+s|
|denom|改变节拍细分|```up```/```down```|
|track|改变当前轨道|```right```/```left```|
|scale|改变当前轨道缩放|无|
|fence|改变当前play区域栅栏数|无|
|music_speed|改变当前播放速度|无|
|note_fake|改变放置note后note的默认真假|无|
|note_head|改变放置hold后默认带note头|无|
|wipe_head|改变放置hold后默认带wipe头|无|

### edit区域

edit区域位于play区域的右方侧边栏的左方 没有任何按钮
- 从左到右的三个轨道分别是```note```轨道 ```x```轨道 ```w```轨道 以下称为第一 二 三 轨道
- 以下称事件为```event```

|操作|方法|注意事项|
|----|----|----|
|放置note/wipe/hold|鼠标指针停留在一轨上按下```q```/```w```/```e```键 放置```hold```尾部时需要再次按下```e```|无法重叠放置 且hold尾部beat应该大于hold头部beat|
|放置event|鼠标指针停留在二/三轨上按下e键 放置尾部时需要再次按下```e```|无法重叠放置 且event尾部beat应该大于event头部beat|
|删除note/event|鼠标指针停留在note/事件上按下```d```键|无|
|选中note/event|左键单击选择|无|
|往复制表里添加/删除该note/event|右键单击选择/删除|无|


#### 快捷操作

|操作|方法|注意事项|
|----|----|----|
|修改note/event beat|选中note/event后按下```alt＋z```改变头部beat 类型为hold/event时可以按下```alt+x```改变尾部beat|无|
|裁剪event|选中event后按下```alt+c```|裁剪后的event长度为当前beat细分的1/2|
|左右翻转event|选中event后按下```alt+b```|起始值和终点值会镜像|
|上下翻转event|选中event后按下```alt+u```|起始值和终点值会互换|
|event数值更改|选中event后在play区域按下```alt+t```|将event的值改为鼠标所在的```x```值，如果鼠标所在beat小于event头部的beat则更改from值，否则更改to值|

### play区域

- 点击play区域的轨道会将当前轨道切换到该轨道 如果多个轨道叠在一起 再次按下可以切换到下一个轨道
- play区域无法编辑event 其余编辑方法 __与edit区域相同__

### 批量操作

#### 触发

- 按住左键会出现复制框 在左键松开之前按下shift会移除复制表中的所有内容 然后添加为现在框选的内容

- 按下```ctrl+x```后会标记成白色 其余标记为白色

- 右键单击note/event会将该其加入复制表

以下操作均需要复制框有内容才会发生

|操作|方式|注意事项|
|----|----|----|
|批量删除note/event|```ctrl+d```|无|
|复制|```ctrl+c```|无|
|裁剪|```ctrl+x```|裁剪后标记会变为白色|
|粘贴|```ctrl+v```|裁剪后的粘贴会删除掉裁剪的内容 如果选中的内容是在play中选中的 则粘贴后不粘贴event|
|粘贴 镜像x事件|```ctrl+b```|裁剪后的粘贴会删除掉裁剪的内容 如果选中的内容是在play中选中的 则粘贴后不粘贴event|
|粘贴|```ctrl+a+v```|裁剪后的粘贴会删除掉裁剪的内容 会粘贴play的event|
|粘贴 镜像x事件|```ctrl+a+b```|裁剪后的粘贴会删除掉裁剪的内容 会粘贴play的event|

::: tip
以下为已删除的快捷键

v0.5.0删除

|操作|方式|注意事项|
|----|----|----|
|轨道快速创建|```ctrl+n```|会依据当前在鼠标所在play的x位置来更改粘贴后event的内容 并且会粘贴到一条新轨道上|
|轨道快速批量创建|```ctrl+a+n```|会依据当前在鼠标所在play的```x```位置来更改粘贴后event的内容 并且会粘贴多条新轨道上|
|同类型事件创建|```ctrl+m```|会依据当前在鼠标所在play的```x```位置来更改粘贴后event的内容 并且会粘贴到当前轨道上|
|批量同类型事件创建|```ctrl+a+m```|会依据当前在鼠标所在play的x位置来更改粘贴后event的内容 并且会粘贴到原来复制的轨道上|

:::

### demo

演示模式 用于预览与录制谱面

- 按下```tab```进入```demo_mode```,再次按下退出
- 期间只能使用```tab```和```space```

## 侧边栏

- 侧边栏功能均较为直观，这里不一一列出

### event

- 按下```enter```将输出在from,to里输入的表达式的结果 例如在from中输入100-50/2 按下enter将输出75

::: tip
        内部遵循lua语法，本质上只是return表达式
:::

### tracks_edit

::: tip

v0.5.0删除

:::

- 进入后会自动进入多轨编辑模式 按下```esc```键会退出 在侧边栏下有add和sub按钮 按下后会添加新的轨道或删除当前选中输入框的轨道

- 在多轨编辑模式中按下```left```/```right```会将当前所有轨道向左/右平移

### multiple_events_edit

- 触发：选中到event

- 扰动会使event的数字增加/减少在-扰动值到+扰动值范围内的随机数

- 从（from）到（to）会赋予选中事件的初始值到结束值的数（数值大小遵循trans）

- trans 是form to的过渡

- trans 有三种类型bezier easing function

- type 为bezier时 string应为bezier的点坐标 第奇数个数字代表这个点的x坐标 第偶数个数字代表这个点的y坐标

例如 

````
        bezier 0,0,1,1

        bezier 0,0,0.5,1,2,2
````

- type 为easing时 string应为数字或是easing的名称 其中当string为easing的名称时 因全部字母小写且每个单词用_隔开

 例如 
 
         easing 1 
 
         easing in_circ 

- type 为function时 string应该为function表达式 函数的传入值为 x 其中x大于等于0 x小于等于1 比如sin这样的函数调用时应该遵循lua的语法

例如 

````
          function 1/x 
          function math.cos(x) 
````

### preference

- 偏好：允许根据个人编辑习惯调整编辑模式 目前支持调整event缩放与偏移

### track

- 允许搜寻轨道与修改轨道属性

|属性|作用|
|----|----|
|轨道名称|略|
|类型|目前有```xw``` ```lposrpos``` 模式 xw即将左边轨道的事件读为x事件，右边读为w事件；lposrpos即将左边轨道的事件读为lpos事件（左边界），右边轨道的事件读为rpos事件（右边界）|
|是否隐藏|决定轨道宽度为0时是否隐藏轨道|
|父轨道|使该轨道的坐标原点设置为父轨道坐标|


## effect

- 目前effect不支持在制谱器内编辑 且只能在演示模式下预览 且目前effect只支持bezier缓动

### effect编辑

- 请前往谱面保存目录中找到谱面并打开（后缀为json）然后找到effect这项属性


#### v0.5.0以上：

- effect写法与event类似 须有trans，beat,beat2,type,from,to这几项属性 请参考开发文档中的event结构

#### v0.5.0以下：

- 参照写法：

````
effect = {
{
        trans={0,0,1,1},
        beat2={0,1,4},
        type='note_alpha',
        beat={0,0,1},
        from=100,
        to=12.5
},
{
        trans={0,1,1,1},
        beat2={4,1,4},
        type='note_rotate',
        beat={3,0,1},
        from=100,
        to=12.5
},
}
````

::: tip
- 其中 每一项应该按照beat从小到大来排列
:::

- type类型有

|类型|范围|
|note_alpha|0-100|
|track_alpha|0-100|
|track_line_alpha|0-100|
|note_rotate|0-2pi|

- 如果数值超了范围（除了note_rotate） 超了范围的部分不会显示出来 （比如 note_alpha 值为110 只会显示为100时候的效果）

## 自定义

### v0.5.0以上：

#### 打击音 

- 请将打击音的前缀改为```hit``` 然后放入```users```文件夹中

#### note

| note类型 |  图片名称 |
|----|----|
| note | note.png |
| hold头 | holdHead.png |
| hold身 | holdBody.png |
| hold尾 | holdTail.png |
| wipe | wipe.png |

#### 键位

- 修改key.lua（在dakumi.exe同一目录）

::: warning

若是导致dakumi功能异常请重新下载一份key.lua

:::

#### 默认bezier表

- 修改defaultBezier.txt（在dakumi.exe同一目录）

::: warning

若是导致dakumi功能异常请重新下载一份defaultBezier.txt

:::

#### 键位

- 修改key.json（在user目录） key的每一个键值对见开发文档

### v0.5.0以下：

- 打击音 请将打击音的前缀改为```hit_sound``` 然后拖入到dakumi的窗口中

- note皮肤 请将图片素材的前缀改成以下的名称并通过```目录```打开dakumi的ui文件夹后导入 所使用的图片大小最好相同

## 报错补救

- 由于开发者水平不高 所以dakumi很可能因为各种原因报错

dakumi会在报错时自动保存谱面，同时，dakumi在user/auto_save文件夹里有曾经自动保存产生的谱面副本，可以用于回溯谱面。将该副本导入dakumi即可

此外记得将bug报告给开发者